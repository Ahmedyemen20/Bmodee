<!doctype html>
<html lang="ar">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>تفاصيل اللعبة</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <div class="game-details">
    <img id="gameImg" src="/no-image.png" alt="صورة اللعبة">
    <h2 id="gameName">اسم اللعبة</h2>
    <p id="gameDesc"></p>
    <p><a id="gameSource" class="source-link" target="_blank" rel="noopener">مصدر</a></p>

    <h3>الإصدارات</h3>
    <div id="versions"></div>
  </div>

<script>
document.addEventListener("DOMContentLoaded", () => {

  const params = new URLSearchParams(location.search);
  const gameName = params.get("name");

  if (!gameName) {
    document.body.innerHTML = "❌ اسم اللعبة غير موجود";
    return;
  }

  const adminGames = JSON.parse(localStorage.getItem("adminGames")) || [];

  const baseGames = [
    {
      name: "Hay Day",
      img: "/unnamed (2).jpg",
      desc: "Hay Day Mod APK Unlimited Money",
      rating: 4.8,
      category: "strategy",
      versions: [{ v: "1.0", size: "150 MB", link: "#" }]
    }
  ];

  const allGames = [...baseGames, ...adminGames];

  const game = allGames.find(
    g => g.name.toLowerCase() === gameName.toLowerCase()
  );

  if (!game) {
    document.body.innerHTML = `
      <div style="text-align:center;margin-top:50px;color:red">
        ❌ اللعبة غير موجودة
      </div>
      <div style="text-align:center;margin-top:20px">
        <a href="index.html">⬅ رجوع</a>
      </div>
    `;
    return;
  }

  // عرض البيانات
  document.getElementById("gameImg").src = game.img;
  document.getElementById("gameName").textContent = game.name;
  document.getElementById("gameDesc").textContent = game.desc || "";

  // رابط المصدر: بحث Google Play حسب اسم اللعبة
  const playLink = `https://play.google.com/store/search?q=${encodeURIComponent(game.name)}&c=apps`;
  const gameSourceEl = document.getElementById("gameSource");
  if (gameSourceEl) {
    gameSourceEl.href = playLink;
    gameSourceEl.textContent = "عرض على Google Play";
  }

  const versionsDiv = document.getElementById("versions");
  versionsDiv.innerHTML = "";

  game.versions.forEach((v, index) => {
    const div = document.createElement("div");
    div.className = "version";

    div.innerHTML = `
      <span>${v.v}</span>
      <span>${v.size || ""}</span>
      <a class="download-btn" href="${v.link}" target="_blank">تحميل</a>

      ${location.search.includes("admin=true") ? `
        <button class="edit-version" onclick="editVersion(${index})">✏️</button>
      ` : ``}
    `;

    versionsDiv.appendChild(div);
  });

  // =========================
  // تعديل الإصدار (أدمن)
  // =========================
  window.editVersion = index => {
    const gameInAdmin = adminGames.find(
      g => g.name.toLowerCase() === game.name.toLowerCase()
    );

    if (!gameInAdmin) {
      alert("هذه اللعبة ليست من إضافات الأدمن");
      return;
    }

    const version = gameInAdmin.versions[index];

    const newV = prompt("رقم الإصدار", version.v);
    if (!newV) return;

    const newSize = prompt("الحجم", version.size || "");
    if (newSize === null) return;

    const newLink = prompt("رابط التحميل", version.link);
    if (!newLink) return;

    version.v = newV;
    version.size = newSize;
    version.link = newLink;

    localStorage.setItem("adminGames", JSON.stringify(adminGames));
    location.reload();
  };

});
</script>

</body>
</html>
